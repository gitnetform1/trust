(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{e27cdf3ff904ddeaf21c:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return G}));var i,r,n=a("4189b631280df3704438"),s=a.n(n),o=a("eb192789b0163ccd7c32"),l=a.n(o),d=a("f3644efa9317fb4b1f19"),u=a.n(d),c=a("56907d3021f9a60fc496"),h=a.n(c),p=a("b043987c9591005bfecb"),f=a.n(p),m=a("05decd0422de0aa28b91"),b=a.n(m),v=a("9d0a762c68b04db80a58"),x=a.n(v),g=a("c941771c892f8eea9763"),y=a.n(g),$=a("549a709a8f94b14e0e58"),_=a.n($),w=a("5f95f5d90d238fa0d86a"),k=a.n(w),T=a("500407a0058749d1d795"),U=a.n(T),z=a("e3f51e93cbcb086f6c06"),E=a.n(z),P=a("ac984996a79308ebe69c"),j=a.n(P),q=a("279c0f0c00aa45d41952"),O=a.n(q),R=a("9466c4bf0b991fb30fa6"),S=a.n(R),L=a("dc270d9db2710066bad8"),F=a.n(L),N=a("a3ffdb541eb5f4236c8d"),C=a.n(N),D=a("e026a4a5eab83117dbc9"),J=a.n(D),H=a("7dcb1f9d91649c22471e"),Z=a.n(H),I=a("802cdb4f0b591dfd1229"),X=a.n(I),M=a("a8f8105d2d40178f277f"),A=a("aa002c9ecdc30c05062b"),K=a.n(A),V=a("12567f097106441c944d");a("000537dc14f76cdbe8f1");function B(e,t){var a=b()(e);if(f.a){var i=f()(e);t&&(i=k()(i).call(i,(function(t){return h()(e,t).enumerable}))),a.push.apply(a,i)}return a}function G(e){var t,a;this.$uploader=X()(e),this.$dropzone=X()("#".concat(this.$uploader.data("dropzone"))),this.$error=X()("#".concat(this.$uploader.data("error"))),this.$pool=X()("#".concat(this.$uploader.data("pool")));var i=X()("#".concat(this.$pool.data("template"))).html();this.$template=X()(Z()(i).call(i)),this.url=this.$uploader.data("create-url"),this.name=this.$uploader.data("name"),this.deleteConfirmMsg=this.$uploader.data("delete-confirm-msg"),this.serialiazedObject=-1===J()(t=this.name).call(t,"_ids][]"),this.uploadError=!1,this.$form=X()(e.form),this.$submit=C()(a=this.$form).call(a,"[type=submit]"),this.isUploading=!1,this.submissionPending=!1,this.init()}G.prototype={init:function(){this.cleanup(),this.populate(),this.setup()},cleanup:function(){this.$pool.empty(),this.$error.hide()},populate:function(){var e=this,t=this.$pool.data("uploads")||[];!function a(){var i=t.shift();if(i){var r=i.display_file_name||i.file_name,n=e.render(function(e){for(var t=1;t<arguments.length;t++){var a,i=null!=arguments[t]?arguments[t]:{};if(t%2)y()(a=B(Object(i),!0)).call(a,(function(t){F()(e,t,i[t])}));else if(u.a)l()(e,u()(i));else{var r;y()(r=B(Object(i))).call(r,(function(t){s()(e,t,h()(i,t))}))}}return e}({},i,{filename:r}));e.setupload(n,i),e.append(n),S()(a,4)}}()},render:function(e){var t=e.filename,a=e.inline,i=this.$template.clone();return a&&i.hide(),this.setLinkText(i,t),this.setInputName(i),i},append:function(e){this.$pool.append(e)},setupload:function(e,t){this.setLinkUrl(e,t.url),this.setPathUrl(e,t.url),this.setRemoveUrl(e,t.delete_url),this.setInputValue(e,t),this.setProgress(e,100),this.setRemoveEvent(e)},setLinkText:function(e,t){C()(e).call(e,"[data-upload-link]").text(t)},setInputName:function(e){C()(e).call(e,"input:hidden").attr("name",this.name)},setLinkUrl:function(e,t){C()(e).call(e,"[data-upload-link]").attr("href",t)},setPathUrl:function(e,t){C()(e).call(e,"[data-upload-path]").text(t)},setRemoveUrl:function(e,t){C()(e).call(e,"[data-upload-remove]").data("delete-url",t)},setInputValue:function(e,t){var a=this.serialiazedObject?t:t.id;C()(e).call(e,"input:hidden").val(O()(a))},setProgress:function(e,t){C()(e).call(e,"[data-upload-progress]").css("width","".concat(t,"%"))},setRemoveEvent:function(e){var t;C()(e).call(e,"[data-upload-remove]").click(X.a.proxy(this.remove,this)),C()(e).call(e,"[data-upload-remove]").keyup(j()(t=this.handleKeyUp).call(t,this))},handleKeyUp:function(e){e.preventDefault(),13!==e.keyCode&&32!==e.keyCode||X.a.proxy(this.remove,this)(e)},setup:function(){this.$uploader.fileupload({dropZone:this.$dropzone,pasteZone:null,url:this.url,dataType:"json",type:"POST",paramName:"file",singleFileUploads:!0,dragover:X.a.proxy(this.dragover,this),add:X.a.proxy(this.add,this),progress:X.a.proxy(this.progress,this),done:X.a.proxy(this.done,this),fail:X.a.proxy(this.error,this),start:X.a.proxy(this.start,this),stop:X.a.proxy(this.stop,this)}),this.$form.on("submit",X.a.proxy(this.submit,this)),this.$dropzone.focusin(X.a.proxy(this.focus,this)),this.$dropzone.focusout(X.a.proxy(this.blur,this))},dragover:function(){var e=this,t=window.dropZoneTimeout;t?clearTimeout(t):this.$dropzone.attr("data-hover",!0),window.dropZoneTimeout=S()((function(){window.dropZoneTimeout=null,e.$dropzone.attr("data-hover",!1)}),100)},add:(r=E()(U.a.mark((function e(t,a){var i,r,n;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.files[0],e.next=3,Object(V.b)();case 3:if(r=e.sent,!this.exists(i.name)){e.next=7;break}return this.flash("File already exists",i.name),e.abrupt("return");case 7:if(void 0===i.size){e.next=11;break}if(this.valid(i)){e.next=11;break}return this.flash("File invalid"),e.abrupt("return");case 11:(n=this.render({filename:i.name})).attr("aria-busy",!0),this.append(n),a.context=n,a.formData=[{name:"authenticity_token",value:r}],a.submit();case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)}),exists:function(e){var t,a,i=this;return!!k()(t=C()(a=this.$pool).call(a,"a")).call(t,(function(){return i.innerText===e})).length},valid:function(e){return e.size>0},progress:function(e,t){var a=t.context;if(a){var i=_()(t.loaded/t.total*100,10);i<=90&&this.setProgress(a,i)}},done:function(e,t){var a=t.context;this.setupload(a,t.result),S()((function(){a.attr("aria-busy",!1)}),1e3)},remove:(i=E()(U.a.mark((function e(t){var a,i,r,n,s,o;return U.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=this.deleteConfirmMsg).length||window.confirm(a)){e.next=3;break}return e.abrupt("return");case 3:return i=X()(t.currentTarget),r=i.closest("[data-upload-item]"),n=i.data("delete-url"),s=this,e.next=6,Object(V.b)();case 6:o=e.sent,this.destroy(n,o).done((function(){r.remove(),s.$uploader.trigger("fileuploadremove")}));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)}),destroy:function(e,t){return X.a.ajax({url:e,method:"DELETE",beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",t)}})},error:function(e,t){var a=t.context,i=this.errorDetails(t);a.remove(),this.uploadError=!0,this.flash(t.errorThrown,i)},errorDetails:function(e){return e.jqXHR.responseJSON&&e.jqXHR.responseJSON[0]&&e.jqXHR.responseJSON[0].error||null},flash:function(e,t){var a,i;switch(e){case"Bad Request":case"File too big":i=K()("txt.help_center.views.shared.upload_error.file_too_big");break;case"File invalid":i=K()("txt.help_center.views.shared.upload_error.file_invalid");break;case"File already exists":i=K()("txt.help_center.views.shared.upload_error.file_already_exist",{filename:t});break;case"Unprocessable Entity":i=K()("txt.help_center.views.shared.upload_error.file_too_big_with_limit",{limit:t.size_limit});break;case"Payload Too Large":i=t;break;case"Request Entity Too Large":default:i=K()("txt.help_center.views.shared.upload_error.connection_lost")}C()(a=this.$error.show()).call(a,"[data-upload-error-message]").text(i)},start:function(){this.isUploading=!0},stop:function(){this.isUploading=!1,!this.submissionPending||this.uploadError?(this.submissionPending&&this.uploadError&&(this.submissionPending=!1,this.$submit.prop("disabled",!1)),this.uploadError=!1):this.$form.submit()},submit:function(e){var t,a,i;if(1!==M.a.get("theming_api_version")||this.isUploading){e.preventDefault(),this.$submit.prop("disabled",!0),this.submissionPending=!0;var r=this.$form[0];y()(t=k()(a=x()(r.querySelectorAll("input[name=request\\[attachments\\]\\[\\]]"))).call(a,(function(e){return!0===JSON.parse(e.value).inline}))).call(t,(function(e){return e.remove()}));var n=document.createElement("template");n.innerHTML=r.querySelector("textarea").value,y()(i=x()(n.content.querySelectorAll("[data-image-token]"))).call(i,(function(e){var t=e.dataset,a=document.createElement("input");a.name="request[attachments][]",a.hidden=!0,a.value=O()({id:t.imageToken,inline:!0}),r.appendChild(a)})),this.isUploading||r.submit()}},focus:function(){this.$dropzone.attr("data-hc-focus",!0)},blur:function(){this.$dropzone.attr("data-hc-focus",!1)}}}}]);